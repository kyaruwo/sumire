<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            rel="shortcut icon"
            href="/app/assets/sumire.png"
            type="image/x-icon"
        />
        <title>sumire</title>

        <link rel="stylesheet" href="/app/assets/sumire.css" />

        <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
        <script src="/app/js/toast.js" defer></script>
        <script src="/app/js/notes.js" defer></script>
    </head>
    <body id="body" class="select-none bg-black text-white">
        <nav class="flex h-20 items-center justify-around">
            <button
                onclick="show_write_note()"
                class="rounded-xl bg-green-500 px-4 py-1 text-xl max-md:text-sm"
            >
                Write
            </button>
            <a href="/app#sumire" class="text-4xl font-black">sumire</a>
            <a
                href="/app/settings"
                class="rounded-xl bg-blue-600 px-4 py-1 text-lg max-md:text-sm"
            >
                Settings
            </a>
        </nav>

        <main id="main" class="mt-4"></main>
    </body>
</html>

<script>
    function show_write_note() {
        document.getElementById("main").innerHTML = /*html*/ `
        <div class="max-md:mx-2 md:mx-20 lg:mx-40">
            <form
                onsubmit="write_note();return false"
                class="flex flex-col rounded border-4 border-solid border-white p-4"
            >
                <input
                    id="note_title"
                    type="text"
                    maxlength="42"
                    placeholder="Title"
                    required
                    class="border-b-2 bg-black p-4 text-4xl font-semibold max-md:text-2xl"
                />
                <textarea
                    id="note_body"
                    type="text"
                    maxlength="420"
                    placeholder="Body"
                    required
                    class="min-h-80 mt-4 h-fit bg-black p-4 text-2xl max-md:text-base"
                ></textarea>
                <div class="mt-4 flex justify-evenly max-sm:text-xs lg:text-xl">
                    <button class="rounded-2xl bg-green-600 p-2 px-4">
                        Write
                    </button>
                    <button
                        onclick="show_notes();return false"
                        class="rounded-2xl bg-orange-600 p-2 px-4"
                    >
                        Cancel
                    </button>
                </div>
            </form>
        </div>
        `;
    }

    async function show_note(id, response_json = undefined) {
        let note;
        if (id) {
            note = await read_note(id);
        } else {
            note = response_json;
        }

        document.getElementById("main").innerHTML = /*html*/ `
        <div class="max-md:mx-2 md:mx-20 lg:mx-40">
            <form
                onsubmit="update_note('${note.note_id}');return false"
                class="flex flex-col rounded border-4 border-solid border-white p-4"
            >
                <input
                    id="note_title"
                    type="text"
                    maxlength="42"
                    placeholder="Title"
                    required
                    class="border-b-2 bg-black p-4 text-4xl font-semibold max-md:text-2xl"
                />
                <textarea
                    id="note_body"
                    type="text"
                    maxlength="420"
                    placeholder="Body"
                    required
                    class="min-h-80 mt-4 h-fit bg-black p-4 text-2xl max-md:text-base"
                ></textarea>
                <div
                    id="show_note_options"
                    class="mt-4 flex justify-evenly max-sm:text-xs lg:text-xl"
                >
                    <button class="rounded-2xl bg-blue-600 p-2 px-4">Update</button>
                    <button
                        onclick="toggle_note_options();return false"
                        class="rounded-2xl bg-red-600 p-2 px-4"
                    >
                        Delete
                    </button>
                    <button
                        onclick="show_notes();return false"
                        class="rounded-2xl bg-orange-600 p-2 px-4"
                    >
                        Return
                    </button>
                </div>
                <div
                    id="delete_confirmation"
                    class="mt-4 hidden justify-evenly max-sm:text-xs lg:text-xl"
                >
                    <button
                        onclick="delete_note('${note.note_id}');return false"
                        class="rounded-2xl bg-red-600 p-2 px-4"
                    >
                        Delete Forever
                    </button>
                    <button
                        onclick="toggle_note_options();return false"
                        class="rounded-2xl bg-green-600 p-2 px-4"
                    >
                        Cancel
                    </button>
                </div>
            </form>
        </div>
        `;
        document.getElementById("note_title").value = note.title;
        document.getElementById("note_body").innerHTML = note.body;
    }

    async function show_notes() {
        document.getElementById("main").innerHTML = /*html*/ `
        <div class="sm:mx-20 lg:mx-32">
            <div
                id="notes"
                class="grid justify-items-center gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"
            ></div>
        </div>
    `;

        const notes = await read_notes();

        notes.forEach((note) => {
            document.getElementById("notes").innerHTML += /*html*/ `
            <div
                onclick="show_note('${note.note_id}')"
                class="h-60 w-60 cursor-pointer rounded border-4 border-solid border-white p-4"
            >
                <h
                    id="note_title_${note.note_id}"
                    class="line-clamp-1 border-b-2 text-2xl font-semibold"
                ></h>
                <p
                    id="note_body_${note.note_id}"
                    class="mt-4 line-clamp-6 text-base"
                ></p>
            </div>
            `;
            document.getElementById(`note_title_${note.note_id}`).innerText =
                note.title;
            document.getElementById(`note_body_${note.note_id}`).innerText =
                note.body;
        });
    }
</script>
